<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Rikki Tooley's Sweet Sweet Page</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="res/css/nprogress.css"/>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://malsup.github.io/jquery.cycle.all.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

    <script type="text/javascript" src="lib/jquery-mousewheel/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="res/js/tiles.js"></script>
    <script type="text/javascript" src="res/js/nprogress.js"></script>

    <!-- TODO tidy up the script section somehow?? -->
    <script type="text/javascript">
        function greeting(random){
            var dt = new Date();
            var hours = dt.getHours();

            var morning = ['Mornin\''];
            var day = ['Alright?', 'Hi there!'];
            var evening = ['Evenin\''];

            console.log('it is at least ' + hours + ':00');
            var greetings;
            if (hours > 3 && hours < 12) {
                greetings = morning;
            }
            else if (hours > 16 && hours < 21) {
                greetings = evening;
            }
            else {
                greetings = day;
            }
            var index = parseInt(random * greetings.length);

            console.log('Chose greeting  ' + index );
            return greetings[index];
        }

        $(window).bind('beforeunload', function() {
            NProgress.done();
        });

        $(document).ready(function() {
            $("body").mousewheel(function(event, delta) {

                this.scrollLeft -= (delta * 30);

                event.preventDefault();

            });

//            var hubItemsCount = $('.hub').children().length;
//            var windowWidth = $(window).width();
//            $('.hub-item').each(function(index)
//            {
//                $(this).css({'width' : windowWidth * 0.9 + 'px'});
//            })
//
//            var desiredWidth = hubItemsCount * windowWidth * 0.95; // TODO reevaluate this when window size changes
//
//            $('.hub').css({'width' : desiredWidth + 'px'});

            $.get("./api/all", null, function(tiles) {

                var space = $('#burrito');
                space.children().remove();

                for (var i = 0; i < tiles.length; i++) {
                    (function (i){
                        var tile = tiles[i];
                        var animation = getAnimation(tile['animation']);

                        getTemplateAsync(tiles[i]['tile-template'], function(template){
                            var filled = fillTileTemplate(template.clone(), tile.title, tile.href, tile.style);

                            if (tile['content-template'])
                            {
                                getTemplateAsync(tile['content-template'], function(template){
                                    var slides = fillContentTemplates(template.clone(), tile.data);

                                    var content = filled.find('.tile-content');
                                    content.children().remove();

                                    for (var i=0; i < slides.length; i++){
                                        content.append(slides[i]);
                                    }

                                    space.append(filled);
                                    animation(filled, i);
                                });
                            }
                            else {
                                space.append(filled);
                                animation(filled, i);
                            }
                        });
                    })(i);
                }

                // tiles should be in place now

                $('.tile > .tile-link').click(function() {
                    NProgress.start();
                });
            });

            $('#header-greeting').text(greeting(Math.random()));
        });
    </script>
</head>
<body>

<div class="hub">
    <div class="hub-item">
        <header class="prime">
            <div class="header-lead">
                <p class="header-greeting">Hello.</p>
                <p>My name is Rikki Tooley, and I'm an independent software developer.</p>
            </div>
        </header>

        <div id="burrito">
            <!-- tiles loaded in here -->
        </div>
    </div>
    <div class="hub-item">
        <header class="prime">
            <div class="header-lead">
                <p class="header-greeting">freelancing</p>
                <p>My name is Rikki Tooley, and I'm an independent software developer.</p>
            </div>
        </header>
    </div>
</div>
</body>
</html>
