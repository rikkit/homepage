<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="/res/css/nprogress.css"/>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://malsup.github.io/jquery.cycle.all.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script type="text/javascript" src="lib/lastfmjs/lastfm.api.js"></script>
    <script type="text/javascript" src="lib/lastfmjs/lastfm.api.cache.js"></script>
    <script type="text/javascript" src="lib/lastfmjs/lastfm.api.md5.js"></script>
    <script type="text/javascript">
        /**
         * TODO support other kinds of template
         * @param template
         * @param primary
         * @param secondary
         * @param image
         */
        function fillTemplate(template, lead, sub, image){

            var imagediv = template.find('.template-image');
            if (template.hasClass('template-image'))
            {
                imagediv = template;
            }

            imagediv.css({
                'background-image' : 'url("' + image + '")'
            });
            template.find('.template-lead').text(lead);

            console.log("Template filled: " + lead + '; ' + sub + '; ' + image);
            return template;
        }

        function populateLastfmTile(animation, div)
        {
            var cache = new LastFMCache();
            var lastfm = new LastFM({
                apiKey    : '4823457a7472a620207cf21ad7663f57',
                apiSecret : '7f26392d49ddd3251532c75ab4e0dc7f',
                cache     : cache
            });

            lastfm.user.getTopArtists({
                user: 'tehrikkit',
                limit: 3,
                period: '7day'
            }, {success: function(data){
                var content = div.find('.tile-content');
                var template = content.children('li').clone();

                content.children().remove();

                for (var i=0; i<data.topartists.artist.length; i++){
                    var artist = data.topartists.artist[i];
                    console.log('Lastfm Tile: ' + artist.name + ' loaded');

                    var filled = fillTemplate(template.clone(), artist.name, null, artist.image[3]['#text'])
                    content.append(filled);
                }

                animation(div);
            }}, {error: function(code, message){
                console.log('Lastfm Tile Error:' + code + message);
            }});
        }

        function metroTileAnimation(div){
            if (div.length){
                div.cycle({
                    delay: 0,
                    autostop: 1,
                    speed: 1050,
                    easing: 'easeOutQuint',
                    fx: 'scrollUp'
                });

                div.find('.tile-content').cycle({
                    delay: 4000,
                    timeout: 5000,
                    speed: 1050,
                    easing: 'easeOutQuint',
                    fx: 'scrollUp'
                });
            }
        }

        $(document).ready(function() {
            populateLastfmTile(metroTileAnimation, $('#top-artists-tile'));
        });
    </script>
</head>
<body>

<div id="top-artists-tile" class="tile lastfm">
    <div class="front">
        <p class="title">Last.fm</p>
    </div>
    <div class="back">
        <ul class="tile-content">
            <li class="fill-template template-image">
                <h3 class="template-lead"></h3>
                <div class="template-overlay"></div>
            </li>
        </ul>
        <p class="title">tehrikkit</p>
        <div class="badge"></div>
    </div>
</div>


</body>
</html>
